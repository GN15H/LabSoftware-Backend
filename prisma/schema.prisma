generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Appointment_Services {
  id             Int          @id @default(autoincrement())
  appointment_id Int
  service_id     Int
  Appointments   Appointments @relation(fields: [appointment_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Appointment_Services_ibfk_1")
  Services       Services     @relation(fields: [service_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Appointment_Services_ibfk_2")

  @@unique([appointment_id, service_id], map: "appointment_id")
  @@index([service_id], map: "service_id")
}

model Appointment_States {
  id           Int            @id @default(autoincrement())
  name         String         @db.VarChar(10)
  Appointments Appointments[]
}

model Appointment_Supplies {
  id             Int          @id @default(autoincrement())
  supply_amount  Int
  supply_id      Int
  appointment_id Int
  Supplies       Supplies     @relation(fields: [supply_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Appointment_Supplies_ibfk_1")
  Appointments   Appointments @relation(fields: [appointment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Appointment_Supplies_ibfk_2")

  @@unique([appointment_id, supply_id], map: "appointment_id")
  @@index([supply_id], map: "supply_id")
}

model Appointments {
  id                   Int                    @id @default(autoincrement())
  appointment_date     DateTime               @db.DateTime(0)
  mechanic_id          Int
  bay_id               Int
  appointment_state_id Int
  vehicle_id           Int
  Appointment_Services Appointment_Services[]
  Appointment_Supplies Appointment_Supplies[]
  Users                Users                  @relation(fields: [mechanic_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Appointments_ibfk_1")
  Bays                 Bays                   @relation(fields: [bay_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Appointments_ibfk_2")
  Appointment_States   Appointment_States     @relation(fields: [appointment_state_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Appointments_ibfk_3")
  Vehicles             Vehicles               @relation(fields: [vehicle_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Appointments_ibfk_4")
  Evidences            Evidences[]

  @@index([appointment_state_id], map: "appointment_state_id")
  @@index([bay_id], map: "bay_id")
  @@index([mechanic_id], map: "mechanic_id")
  @@index([vehicle_id], map: "vehicle_id")
}

model Bays {
  id           Int            @id @default(autoincrement())
  name         String         @db.VarChar(20)
  Appointments Appointments[]
}

model Evidence_Types {
  id        Int         @id @default(autoincrement())
  name      String      @db.VarChar(10)
  Evidences Evidences[]
}

model Evidences {
  id               Int            @id @default(autoincrement())
  description      String         @db.VarChar(50)
  file_path        String?        @db.VarChar(255)
  evidence_type_id Int
  appointment_id   Int
  Evidence_Types   Evidence_Types @relation(fields: [evidence_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Evidences_ibfk_1")
  Appointments     Appointments   @relation(fields: [appointment_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Evidences_ibfk_2")

  @@index([appointment_id], map: "appointment_id")
  @@index([evidence_type_id], map: "evidence_type_id")
}

model Mechanics_Specialties {
  id           Int         @id @default(autoincrement())
  specialty_id Int
  mechanic_id  Int
  Specialties  Specialties @relation(fields: [specialty_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Mechanics_Specialties_ibfk_1")
  Users        Users       @relation(fields: [mechanic_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Mechanics_Specialties_ibfk_2")

  @@unique([mechanic_id, specialty_id], map: "mechanic_id")
  @@index([specialty_id], map: "specialty_id")
}

model Services {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(30)
  Appointment_Services Appointment_Services[]
}

model Specialties {
  id                    Int                     @id @default(autoincrement())
  name                  String                  @db.VarChar(20)
  Mechanics_Specialties Mechanics_Specialties[]
}

model Suppliers {
  id       Int        @id @default(autoincrement())
  name     String     @db.VarChar(20)
  phone    String     @db.VarChar(20)
  email    String     @unique(map: "email") @db.VarChar(30)
  Supplies Supplies[]
}

model Supplies {
  id                   Int                    @id @default(autoincrement())
  name                 String                 @db.VarChar(30)
  supplier_id          Int
  supply_type_id       Int
  Appointment_Supplies Appointment_Supplies[]
  Suppliers            Suppliers              @relation(fields: [supplier_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Supplies_ibfk_1")
  Supply_Types         Supply_Types           @relation(fields: [supply_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Supplies_ibfk_2")

  @@index([supplier_id], map: "supplier_id")
  @@index([supply_type_id], map: "supply_type_id")
}

model Supply_Types {
  id       Int        @id @default(autoincrement())
  name     String     @unique(map: "name") @db.VarChar(20)
  Supplies Supplies[]
}

model User_Types {
  id    Int     @id @default(autoincrement())
  name  String? @unique(map: "name") @db.VarChar(20)
  Users Users[]
}

model Users {
  id                    Int                     @id @default(autoincrement())
  dni                   String                  @unique(map: "dni") @db.VarChar(20)
  name                  String                  @db.VarChar(50)
  last_name             String                  @db.VarChar(50)
  email                 String                  @unique(map: "email") @db.VarChar(50)
  password              String                  @db.VarChar(50)
  birth_date            DateTime                @db.Date
  user_type_id          Int
  Appointments          Appointments[]
  Mechanics_Specialties Mechanics_Specialties[]
  User_Types            User_Types              @relation(fields: [user_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Users_ibfk_1")
  Vehicles              Vehicles[]

  @@index([user_type_id], map: "user_type_id")
}

model Vehicle_Types {
  id       Int        @id @default(autoincrement())
  name     String     @unique(map: "name") @db.VarChar(20)
  Vehicles Vehicles[]
}

model Vehicles {
  id              Int            @id @default(autoincrement())
  number_plate    String         @unique(map: "number_plate") @db.VarChar(10)
  brand           String         @db.VarChar(20)
  series          String?        @db.VarChar(20)
  vehicle_type_id Int
  owner_id        Int
  Appointments    Appointments[]
  Vehicle_Types   Vehicle_Types  @relation(fields: [vehicle_type_id], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "Vehicles_ibfk_1")
  Users           Users          @relation(fields: [owner_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "Vehicles_ibfk_2")

  @@index([owner_id], map: "owner_id")
  @@index([vehicle_type_id], map: "vehicle_type_id")
}
